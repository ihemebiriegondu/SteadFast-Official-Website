<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steadfast Admin Dashboard</title>

    <link rel="shortcut icon" href="../images/logo.jpg" type="image/x-icon">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../css/main.min.css">

    <link rel="stylesheet" href="dashboard.css">
</head>

<body class="dashboard-body">
    <div class="home">
        <div class="bg-primary dark-div">
            <div class="first-home-div d-flex align-items-baseline">
                <div>
                    <a href="#sidebar" class="navbar-toggler border-0" type="button" data-bs-toggle="offcanvas"
                        role="button" aria-controls="sidebar">
                        <i class="bi bi-list text-primary"></i>
                    </a>
                </div>
                <div class="d-flex">
                    <h1 class="mb-0 mt-0 text-primary fw-normal me-1">SPS</h1>
                    <img src="../images/logo-removebg-preview.png" alt="">
                </div>
            </div>
            <div>
                <div class="offcanvas offcanvas-end" tabindex="1" id="sidebar" aria-labelledby="sidebar-label">
                    <div class="offcanvas-header">
                        <button type="button" class="btn-close mt-3" data-bs-dismiss="offcanvas"
                            aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body ps-5">
                        <ul class="navbar-nav text-uppercase mb-2 mb-lg-0 w-100 justify-content-around">
                            <li class="nav-item">
                                <a class="nav-link active text-primary" aria-current="page" href="./index.html">Home</a>
                            </li>
                        </ul>
                        <div class="accordion accordion-flush p-0" id="accordionFlushExample">
                            <div class="accordion-item border-0 mb-4">
                                <h2 class="accordion-header fs-6 fw-normal" id="flush-headingOne">
                                    <a class="accordion-button justify-content-start collapsed p-0 bg-light border-0 text-primary text-decoration-none text-uppercase"
                                        href="" role="button" data-bs-toggle="collapse"
                                        data-bs-target="#flush-collapseOne" aria-expanded="false"
                                        aria-controls="flush-collapseOne">
                                        About
                                    </a>
                                </h2>
                                <div id="flush-collapseOne" class="accordion-collapse collapse"
                                    aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
                                    <div class="accordion-body bg-light pb-0">
                                        <ul class="border-0 text-uppercase py-2 mb-0" style="list-style-type: none;">
                                            <li><a class="text-primary text-decoration-none" href="./about.html">About
                                                    Us</a></li>
                                            <hr class="text-primary opacity-0">
                                            <li><a class="text-primary text-decoration-none" href="./staff.html">Meet
                                                    Our
                                                    Staffs</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item border-0 mb-4">
                                <h2 class="accordion-header fs-6 fw-normal" id="flush-headingTwo">
                                    <a class="accordion-button collapsed p-0 bg-light border-0 text-primary text-decoration-none text-uppercase"
                                        href="#" role="button" data-bs-toggle="collapse"
                                        data-bs-target="#flush-collapseTwo" aria-expanded="false"
                                        aria-controls="flush-collapseTwo">
                                        News & Events
                                    </a>
                                </h2>
                                <div id="flush-collapseTwo" class="accordion-collapse collapse"
                                    aria-labelledby="flush-headingTwo" data-bs-parent="#accordionFlushExample">
                                    <div class="accordion-body bg-light pb-0">
                                        <ul class="border-0 text-uppercase py-2 mb-0" style="list-style-type: none;">
                                            <li><a class="text-primary text-decoration-none"
                                                    href="./calender.html">Upcoming
                                                    Events</a></li>
                                            <hr class="text-primary opacity-0">
                                            <li><a class="text-primary text-decoration-none"
                                                    href="./news.html">newsroom</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item border-0 mb-4">
                                <h2 class="accordion-header fs-6 fw-normal" id="flush-headingThree">
                                    <a class="accordion-button collapsed p-0 bg-light border-0 text-primary text-decoration-none text-uppercase"
                                        href="#" role="button" data-bs-toggle="collapse"
                                        data-bs-target="#flush-collapseThree" aria-expanded="false"
                                        aria-controls="flush-collapseThree">
                                        Enrollment
                                    </a>
                                </h2>
                                <div id="flush-collapseThree" class="accordion-collapse collapse"
                                    aria-labelledby="flush-headingThree" data-bs-parent="#accordionFlushExample">
                                    <div class="accordion-body bg-light pb-0">
                                        <ul class="border-0 text-uppercase py-2 mb-0" style="list-style-type: none;">
                                            <li><a class="text-primary text-decoration-none"
                                                    href="./apply.html">Apply</a>
                                                <hr class="text-primary opacity-0">
                                            <li><a class="text-primary text-decoration-none" href="./faqs.html">FAQs</a>
                                            </li>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <li class="nav-item text-decoration-none m-0 text-uppercase" style="list-style-type: none;">
                            <a class="nav-link text-primary p-0" href="./contact.html">Contact Us</a>
                        </li>
                        <form class="d-sm-none d-flex mb-0 mt-3" role="search">
                            <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                            <button class="btn btn-outline-primary" type="submit"><i class="bi bi-search"></i></button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="second-home-div">
                <h1 class="text-light text-center p-0 m-0">Dashboard</h1>
            </div>
        </div>
        <div class="third-home-div">
            <div class="upward-margin">
                <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-4">
                    <div class="col m-0">
                        <div class="card justify-content-center shadow" onclick="showEventBackdrop(event)">
                            <div class="d-flex flex-column align-items-center justify-content-center">
                                <i class="bi bi-calendar-plus text-center text-primary"></i>
                                <p class="text-center p-0 m-0 text-primary">Upcoming Events</p>
                            </div>
                        </div>
                    </div>
                    <div class="col m-0">
                        <div class="card justify-content-center shadow">
                            <div class="d-flex flex-column justify-content-center">
                                <i class="bi bi-people text-center text-primary"></i>
                                <p class="text-center p-0 m-0 text-primary">Staffs</p>
                            </div>
                        </div>
                    </div>
                    <div class="col m-0">
                        <div class="card justify-content-center shadow">
                            <div class="d-flex flex-column align-items-center justify-content-center">
                                <i class="bi bi-calendar-plus text-center text-primary"></i>
                                <p class="text-center p-0 m-0 text-primary">Upcoming Events</p>
                            </div>
                        </div>
                    </div>
                    <div class="col m-0">
                        <div class="card justify-content-center shadow">
                            <div class="d-flex flex-column align-items-center justify-content-center">
                                <i class="bi bi-calendar-plus text-center text-primary"></i>
                                <p class="text-center p-0 m-0 text-primary">Upcoming Events</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="upcoming-events active">
        <div class="bg-primary dark-div">
            <div class="first-home-div d-flex align-items-baseline">
                <div>
                    <a href="#sidebar" class="navbar-toggler border-0" type="button" data-bs-toggle="offcanvas"
                        role="button" aria-controls="sidebar">
                        <i class="bi bi-list text-primary"></i>
                    </a>
                </div>
                <div class="d-flex">
                    <h1 class="mb-0 mt-0 text-primary fw-normal me-1">SPS</h1>
                    <img src="../images/logo-removebg-preview.png" alt="">
                </div>
            </div>
            <div class="second-home-div">
                <h1 class="text-light text-center p-0 m-0">Upcoming Events</h1>
            </div>
        </div>
        <div class="pt-5">
            <ul id="upcomingevent">
                <!-- Adding list elements -->
            </ul>
        </div>
        <div class="d-flex align-items-center justify-content-center">
            <button class="btn add-btn mt-5" type="button" data-bs-toggle="modal" data-bs-target="#staticBackdrop2">Add Event</button>
        </div>
    </div>

    <!--Modals-->

    <!--Edit modal-->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-4" id="staticBackdropLabel">Edit Event</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-5">
                        <img src="../images/miami.jpg" alt="" class="eventImg">
                        <input type="file" accept="image/*" id="img-input" class="" />
                    </div>
                    <div class="mb-4">
                        <h5>Title: </h5>
                        <input type="text" value="Graduation" id="titleInput">
                    </div>
                    <div class="mb-4">
                        <h5>Date: </h5>
                        <input type="date" value="2013-01-08" id="dateInput">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="editEventButton">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!--Add new modal-->
    <div class="modal fade" id="staticBackdrop2" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel2" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-4" id="staticBackdropLabel2">Add New Event</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-5">
                        <img src="" alt="" class="eventImg d-none" id="displayImage">
                        <label for="newImg-input" class="text-center">
                            Choose image
                        </label>
                        <input type="file" accept="image/*" id="newImg-input" class="" />
                    </div>
                    <div class="mb-4">
                        <h5>Title: </h5>
                        <input type="text" value="" id="newTitleInput">
                    </div>
                    <div class="mb-4">
                        <h5>Date: </h5>
                        <input type="date" value="" id="newDateInput">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="addEventButton">Add</button>
                </div>
            </div>
        </div>
    </div>




    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-analytics.js";
        // Add Firebase products that you want to use
        import { getAuth } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js'
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js'
        import { getStorage, ref, uploadString, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-storage.js";

        import {
            collection,
            getDocs
        } from 'https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js'

        const firebaseConfig = {
            apiKey: "AIzaSyD6z-NHLx-jHtua5qxsRYXB6tQ52RJ1QvU",
            authDomain: "steadfastprivateschools-admin.firebaseapp.com",
            projectId: "steadfastprivateschools-admin",
            storageBucket: "steadfastprivateschools-admin.appspot.com",
            messagingSenderId: "283296008725",
            appId: "1:283296008725:web:6d1fca5d8cf93930ba1c1c",
            measurementId: "G-0FX402CLGG"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const storage = getFirestore(app)
        const Imstorage = getStorage(app);

        const upcomingEventsList = document.getElementById("upcomingevent")
        //getting upcoming events
        const upcomingEvents = collection(storage, 'Upcoming-events');


        //checking if there is a user signed in
        //console.log(localStorage.getItem("user"))
        let currentuser = localStorage.getItem("user")
        if (currentuser == null) {
            window.location.replace("http://127.0.0.1:5500/admins/admindashlogin.html");
        }

        //updating the events
        getDocs(upcomingEvents)
            .then((upcomingEvent) => {
                let events = []
                upcomingEvent.docs.forEach((doc) => {
                    events.push({ ...doc.data(), id: doc.id })
                })
                //console.log(events)
                events.forEach(event => {
                    //console.log(event)
                    var li = document.createElement('li');
                    li.innerHTML = `
                        <div class="mb-4">
                            <h6>${event.Date + ' ' + event.monthyear + " - " + event.Title}</h6>
                            <button type="button" class="btn edit-btn ms-3" data-bs-toggle="modal" data-bs-target="#staticBackdrop" onclick="showEditEventModal(event)">Edit</button>
                            <p class="d-none">${event.Title}</p>
                            <img width = "20px" class="d-none" src="${event.imageSrc}" alt="">
                            <p class="d-none">${event.fulldate}</p>
                        </div>
                    `;
                    upcomingEventsList.appendChild(li);
                });
            })


        //getting image file and changing the src
        let imgInput = document.getElementById("newImg-input")
        const getImageURl = () => {
            let sampleImg = document.getElementById("displayImage")
            let reader = new FileReader();
            let imgInputFile = imgInput.files[0]
            let imgInputFileName = imgInputFile.name

            //console.log(imgInputFileName)
            reader.readAsDataURL(imgInputFile);
            //console.log(imgInput.files[0]);
            reader.onload = () => {
                sampleImg.setAttribute("src", reader.result)
                sampleImg.classList.remove("d-none")

                let readerResult = reader.result
                //console.log(readerResult)
            }

            const imageURL = sampleImg.getAttribute("src")
            return [imgInputFileName, imageURL]
        }

        function addNewEvent() {
            let input = document.querySelector("input").value

            //console.log(input)
            var dateEntered = new Date(input);
            let date = dateEntered.getDate()
            //console.log(dateEntered);
            console.log(date.toLocaleString('en-us', { minimumIntegerDigits: 2, useGrouping: false }))
            console.log(dateEntered.toLocaleString('en-us', { month: 'short', year: 'numeric' }))

            let newReader = getImageURl()
            const newReaderResult = newReader[1]
            //console.log(newReaderResult)
            const fileName = newReader[0]

            //getting events images
            const storageRef = ref(Imstorage, `images/${fileName}`);

            try {
                uploadString(storageRef, newReaderResult, 'data_url').then(
                    (snapshot) => {
                        console.log('Uploaded a data_url string!');
                        getDownloadURL(snapshot.ref).then((link) => {
                            console.log(link)
                        })
                    },
                    (error) => {
                        console.log(error)
                    }
                );
            } catch (error) {
                console.log(error)
            }
        }


        document.getElementById("addEventButton").addEventListener("click", addNewEvent)
        imgInput.addEventListener("change", getImageURl)





    </script>
    <script src="./showModals.js"></script>
</body>

</html>